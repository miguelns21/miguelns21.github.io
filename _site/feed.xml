<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2021-08-23T13:00:16+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Miguelns21 | Cuaderno de bitácora</title><subtitle>Artículos sobre tecnología, programación y ciberseguridad</subtitle><author><name>Miguelns21</name></author><entry><title type="html">Intranet/Nextcloud (Parte 4/4)</title><link href="http://localhost:4000/creacion-intranet-nextcloud-4/" rel="alternate" type="text/html" title="Intranet/Nextcloud (Parte 4/4)" /><published>2021-08-18T00:00:00+02:00</published><updated>2021-08-18T00:00:00+02:00</updated><id>http://localhost:4000/creacion-intranet-nextcloud-4</id><content type="html" xml:base="http://localhost:4000/creacion-intranet-nextcloud-4/">&lt;h1 id=&quot;consideraciones-finales&quot;&gt;Consideraciones finales&lt;/h1&gt;

&lt;p&gt;Programar un script que hace algo pero que es difícil comprobar el resultado es una práctica poco segura.&lt;/p&gt;

&lt;p&gt;Nuestros scripts incorporan la salida de todos los procesos que llevan a cabo a un fichero que se situará en la raíz del la zona del usuario administrador.&lt;/p&gt;

&lt;p&gt;Este fichero de log registra todos los movimientos que el script ha llevado a cabo o no por distintos motivos. Los principales controles que registra son:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Incorrecto formato del fichero de clientes CSV&lt;/li&gt;
  &lt;li&gt;Creación de usuario correcta o no.&lt;/li&gt;
  &lt;li&gt;Factura repartida a qué usuario.&lt;/li&gt;
  &lt;li&gt;etc.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Espero que estos scripts puedan servir de base o ayudar al desarrollo de una versión adaptada a las necesidades de cualquier pequeña empresa.&lt;/p&gt;

&lt;p&gt;Los scripts están disponibles en mi &lt;a href=&quot;https://github.com/miguelns21/NextIntranet&quot;&gt;Github&lt;/a&gt;.&lt;/p&gt;</content><author><name>Miguelns21</name></author><category term="Script" /><category term="Intranet" /><category term="Nextcloud" /><summary type="html">Programar un script que hace algo pero que es difícil comprobar el resultado es una práctica poco segura.</summary></entry><entry><title type="html">Intranet/Nextcloud (Parte 3/4)</title><link href="http://localhost:4000/creacion-intranet-nextcloud-3/" rel="alternate" type="text/html" title="Intranet/Nextcloud (Parte 3/4)" /><published>2021-08-17T00:00:00+02:00</published><updated>2021-08-17T00:00:00+02:00</updated><id>http://localhost:4000/creacion-intranet-nextcloud-3</id><content type="html" xml:base="http://localhost:4000/creacion-intranet-nextcloud-3/">&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/nextcloud-square-logo.png&quot; /&gt;
&lt;/p&gt;

&lt;h1 id=&quot;repartir-facturas&quot;&gt;Repartir Facturas&lt;/h1&gt;

&lt;p&gt;Nuestro segundo y último script “repartir_ficheros.py” tiene como misión repartir los ficheros que el administrador suba a la carpeta “Reparto_Factura” de su zona de administración a todos los usuarios del sistema que les correspondan.&lt;/p&gt;

&lt;p&gt;La lógica debe ser que el nombre del fichero a repartir comience con el código del usuario en nuestra intranet.&lt;/p&gt;

&lt;p&gt;Por ejemplo: la factura “1000-noviembre.pdf” moverá dicho fichero a la zona de usuario con código 1000.&lt;/p&gt;

&lt;p&gt;El administrador puede crear una estructura de carpetas en su carpeta “Reparto_Factura“ que se replicará a la zona del usuario. Por ejemplo:&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-17.42.27.png&quot; /&gt;
&lt;/p&gt;

&lt;h2 id=&quot;cron&quot;&gt;Cron&lt;/h2&gt;

&lt;p&gt;Al igual que el script de creación de usuario, nuestro script de reparto se debe programar con la frecuencia estimada por el administrador de la plataforma atendiendo a sus necesidades. Esto es, si las facturas se suben con poca frecuencia, no tiene sentido establecer la programación muy frecuentemente.&lt;/p&gt;

&lt;p&gt;En el caso de Hostens, el panel de control nos ofrece un asistente para los trabajos de cron como se muestra a continuación:&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-17.48.30.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Fichero de creación de usuarios programado cada 5 minutos.&lt;/p&gt;</content><author><name>Miguelns21</name></author><category term="Script" /><category term="Intranet" /><category term="Nextcloud" /><summary type="html">Nuestro segundo y último script “repartir_ficheros.py” tiene como misión repartir los ficheros que el administrador suba a la carpeta “Reparto_Factura” de su zona de administración a todos los usuarios del sistema que les correspondan.</summary></entry><entry><title type="html">Intranet/Nextcloud (Parte 2/4)</title><link href="http://localhost:4000/creacion-intranet-nextcloud-2/" rel="alternate" type="text/html" title="Intranet/Nextcloud (Parte 2/4)" /><published>2021-08-16T00:00:00+02:00</published><updated>2021-08-16T00:00:00+02:00</updated><id>http://localhost:4000/creacion-intranet-nextcloud-2</id><content type="html" xml:base="http://localhost:4000/creacion-intranet-nextcloud-2/">&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/nextcloud-square-logo.png&quot; /&gt;
&lt;/p&gt;

&lt;h1 id=&quot;importar-usuarios&quot;&gt;Importar Usuarios&lt;/h1&gt;

&lt;p&gt;Nuestro primer script “importar_usuario.py” tiene como misión importar los ficheros CSV que el administrador suba a la carpeta Clientes_CSV de nuestra intranet. Los pasos que sigue en script son:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Crea el usuario en NextCloud.&lt;/li&gt;
  &lt;li&gt;Manda un email a dicho usuario notificándole su usuario y contraseña aleatoria que el usuario puede/debe cambiar en el primer acceso.&lt;/li&gt;
  &lt;li&gt;Crea la estructura de carpetas en la zona de usuario.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;formato-del-fichero&quot;&gt;Formato del fichero&lt;/h2&gt;

&lt;p&gt;El fichero de clientes con extensión csv debe tener la siguiente estructura:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-csv&quot;&gt;Abonado;Razón social Cliente;Email empresa
1000;Pepe;miguelns@gmail.com
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;El primero (1000) es el código que recibirá el cliente en nuestra plataforma. Puede ser numérico o alfanumérico. En cualquier caso dicho código será la primera cadena del nombre del fichero de facturas a repartir.&lt;/p&gt;

&lt;p&gt;En nuestro ejemplo, las facturas para el usuario 1000 deben empezar por 1000_loquesea.pdf.&lt;/p&gt;

&lt;p&gt;Los demás campos se explican por sí mismos.&lt;/p&gt;

&lt;h2 id=&quot;cron&quot;&gt;Cron&lt;/h2&gt;

&lt;p&gt;Nuestro script se debe programar con la frecuencia estimada por el administrador de la plataforma atendiendo a sus necesidades. Esto es, si la necesidad de crear clientes nuevos no fuera mucha no tiene sentido establecer la programación con demasiada frecuencia.&lt;/p&gt;

&lt;p&gt;En el caso de Hostens, el panel de control nos ofrece un asistente para los trabajos de cron como se muestra a continuación:&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-17.33.20.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Fichero de creación de usuarios programado cada 5 minutos.&lt;/p&gt;</content><author><name>Miguelns21</name></author><category term="Script" /><category term="Intranet" /><category term="Nextcloud" /><summary type="html">Nuestro primer script “importar_usuario.py” tiene como misión importar los ficheros CSV que el administrador suba a la carpeta Clientes_CSV de nuestra intranet.</summary></entry><entry><title type="html">Intranet/Nextcloud (Parte 1/4)</title><link href="http://localhost:4000/creacion-intranet-nextcloud-1/" rel="alternate" type="text/html" title="Intranet/Nextcloud (Parte 1/4)" /><published>2021-08-15T00:00:00+02:00</published><updated>2021-08-15T00:00:00+02:00</updated><id>http://localhost:4000/creacion-intranet-nextcloud-1</id><content type="html" xml:base="http://localhost:4000/creacion-intranet-nextcloud-1/">&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.11.28.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Nuestra Intranet parte de una instalación de &lt;em&gt;Nextcloud&lt;/em&gt; con varios retoques.&lt;/p&gt;

&lt;p&gt;Cualquier proveedor de internet tiene en su panel cpanel/plesk una forma de instalar Nextcloud muy sencilla. En nuestro caso el hosting de pruebas está en 
&lt;a href=&quot;https://www.hostens.com&quot;&gt;hostens&lt;/a&gt; que para las pruebas iniciales está bien.&lt;/p&gt;

&lt;h2 id=&quot;instalación&quot;&gt;Instalación&lt;/h2&gt;

&lt;p&gt;La instalación no nos llevará mas que unos cuantos clics. De esta forma ya tenemos nuestro Nextcloud instalado&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.14.29.png&quot; /&gt;
&lt;/p&gt;

&lt;h2 id=&quot;configuración&quot;&gt;Configuración&lt;/h2&gt;

&lt;p&gt;Una vez instalado necesitaremos acceder a él y crear el usuario y la contraseña que será el administrador de nuestra intranet. En este momento tenemos Nextcloud instalado pero todavía nos quedan unos ajustes para adaptarlo a nuestras necesidades de Intranet.&lt;/p&gt;

&lt;h3 id=&quot;1-ponerlo-en-castellano-y-habilitar-nuestro-dominio&quot;&gt;1. Ponerlo en castellano y habilitar nuestro dominio&lt;/h3&gt;

&lt;p&gt;Tenemos que modificar/añadir un par de claves que se encuentran en el archivo config/config.ini del directorio de nuestra instalación.&lt;/p&gt;

&lt;p&gt;Hostens nos provee en el panel de control de un administrador de ficheros con el que podemos hacer los cambios:&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.25.44.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Aquí retocaremos el apartado dominio y el lenguaje:&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.27.26-1.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;En el array ponemos los dominios desde los que llamaremos a nextcloud.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.27.36.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Para que todo aparezca en castellano.&lt;/p&gt;

&lt;h3 id=&quot;2-estructura-de-carpetas-para-los-usuarios&quot;&gt;2. Estructura de carpetas para los usuarios&lt;/h3&gt;

&lt;p&gt;También hay que preparar el /core/skeleton para que al crear el usuario nos aseguremos que la estructura es correcta.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.35.54.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Cada usuario tendrá la carpeta Factura en su home.&lt;/p&gt;

&lt;h3 id=&quot;3-cron&quot;&gt;3. Cron&lt;/h3&gt;

&lt;p&gt;Nextcloud recomienda en su instalación que se programe una tarea de cron en el sistema que lo albergue para su correcto funcionamiento. Aunque existen varias posibilidades, lo mejor, cron.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.38.35.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Seleccionamos cron en los ajustes del administrador.&lt;/p&gt;

&lt;p&gt;Hostens nos provee también de una interfaz muy amigable para establecer la tarea de cron de Nextcloud cada 5 minutos.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.44.19.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Acceso a Cron en el panel de Hostens.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.45.51.png&quot; /&gt;
&lt;/p&gt;

&lt;h3 id=&quot;4-configuración-de-nuestro-correo-saliente&quot;&gt;4. Configuración de nuestro correo saliente&lt;/h3&gt;

&lt;p&gt;Necesitaremos una cuenta de email que será el remitente de cuantos correos mandemos a los clientes. Se ha de configurar en los ajustes del administrador de NextCloud (Ajustes básicos):&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.48.20.png&quot; /&gt;
&lt;/p&gt;

&lt;h3 id=&quot;5-configurar-las-aplicaciones-instaladas&quot;&gt;5. Configurar las aplicaciones instaladas&lt;/h3&gt;

&lt;p&gt;Por defecto, Nextcloud incluye muchas aplicaciones instaladas que en nuestro caso no son necesarias.&lt;/p&gt;

&lt;p&gt;En el panel de control del administrador debemos dejar exclusivamente las aplicaciones que se describen en la siguiente captura:&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.52.10.png&quot; /&gt;
&lt;/p&gt;
&lt;p&gt;Aplicaciones instaladas en nuestra intranet.&lt;/p&gt;

&lt;p&gt;Todas las demás aplicaciones no aportan para nuestro caso. Las dejaremos deshabilitadas.&lt;/p&gt;

&lt;h3 id=&quot;6-estructura-del-usuario-administrador&quot;&gt;6. Estructura del usuario administrador&lt;/h3&gt;

&lt;p&gt;El usuario administrador debe tener una configuración de carpetas como la que se describe en la siguiente imagen:&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-16.55.17.png&quot; /&gt;
&lt;/p&gt;
&lt;p&gt;Estructura de las carpeta en la zona de administración.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;**Clientes_CSV : Contendrá los ficheros csv con los clientes que nuestros scripts crearán en NextCloud en un formato que se verá mas adelante.&lt;/li&gt;
  &lt;li&gt;**Plantillas_Email: Nuestros scripts pueden mandar correos con un formato preestablecido o bien leer los ficheros html de esta carpeta para mandar emails personalizados.&lt;/li&gt;
  &lt;li&gt;**Reparto_Facturas: El administrador subirá a esta carpeta los ficheros de facturas con formato pdf que nuestros scripts repartirán a los clientes que les correspondan.&lt;/li&gt;
  &lt;li&gt;**scripts: Contiene los scripts python del programa.&lt;/li&gt;
&lt;/ol&gt;</content><author><name>Miguelns21</name></author><category term="Script" /><category term="Intranet" /><category term="Nextcloud" /><summary type="html">Nuestra Intranet parte de una instalación de Nextcloud con varios retoques. Cualquier proveedor de internet tiene en su panel cpanel/plesk una forma de instalar Nextcloud muy sencilla.</summary></entry><entry><title type="html">Creación de Intranet/Nextcloud</title><link href="http://localhost:4000/creacion-intranet-nextcloud/" rel="alternate" type="text/html" title="Creación de Intranet/Nextcloud" /><published>2021-08-14T00:00:00+02:00</published><updated>2021-08-14T00:00:00+02:00</updated><id>http://localhost:4000/creacion-intranet-nextcloud</id><content type="html" xml:base="http://localhost:4000/creacion-intranet-nextcloud/">&lt;p&gt;&lt;img src=&quot;/assets/images/creacion-intranet-nextcloud/captura-de-pantalla-2021-08-14-a-las-12.26.26.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Hace un tiempo desarrollé unos scripts en Python para cubrir una necesidad que puede surgir en una empresa pequeña con pocos recursos como es la de dotar a sus propios clientes de un espacio donde éstos puedan consultar sus facturas y descargarlas.&lt;/p&gt;

&lt;h2 id=&quot;acciones&quot;&gt;Acciones&lt;/h2&gt;

&lt;p&gt;Los scripts que funcionarán prácticamente en cualquier hosting o máquina dedicada efectuarán las siguientes acciones:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Creación de usuarios importando un script csv sencillo. Se mandará al usuario un email con los datos para el primer acceso incluyendo una clave aleatoria.&lt;/li&gt;
  &lt;li&gt;Reparto de las facturas en pdf que la empresa subirá a su zona de administración con el formato id_factura.pdf. El sistema notificará al usuario por email de nuevas facturas en su zona de usuario.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ventajas&quot;&gt;Ventajas&lt;/h2&gt;

&lt;p&gt;Las ventajas de este sistema son muchas:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Aprovechar la infraestructura que crea una software open source como es Nextcloud: seguridad de los datos y simplicidad de manejo.&lt;/li&gt;
  &lt;li&gt;Los documentos sensibles como son las facturas “no viajan” al correo electrónico del usuario, sino que es el cliente final el que accede a sus facturas.
Aislamiento. Aunque Nextcloud es una plataforma en la que se fomenta el intercambio de información entre usuarios también se puede adaptar para que los usuarios estén aislados de los otros.&lt;/li&gt;
  &lt;li&gt;A través de un fichero de configuración de texto, el administrador puede adaptar distintos parámetros de su hosting como son los distintos paths o la configuración de su correo saliente.&lt;/li&gt;
  &lt;li&gt;Los scripts en Python serán publicados en Github para que se puedan adaptar a otras necesidades si así se requiere.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;A través de una serie de próximos artículos iré explicando desde la configuración inicial de Nextcloud hasta la configuración de los scripts y su programación en cron.&lt;/p&gt;</content><author><name>Miguelns21</name></author><category term="Script" /><category term="Intranet" /><category term="Nextcloud" /><summary type="html">Hace un tiempo desarrollé unos scripts en Python para cubrir una necesidad que puede surgir en una empresa pequeña con pocos recursos como es la de dotar a sus propios clientes de un espacio donde éstos puedan consultar sus facturas y descargarlas.</summary></entry></feed>